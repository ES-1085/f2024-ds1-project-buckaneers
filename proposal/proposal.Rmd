---
title: "Soil Factors Influenced by Agriculture & Livestock Management Project Proposal"
author: "Buckaneers"
output: html_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)

Data2 <- read_csv("../data/Data2.csv")

library(readr)
library(dplyr)
library(janitor)
library(ggthemes)
library(gapminder)

```

## 1. Introduction

We are analyzing the influence of inherent soil factors and agricultural management on soil organic matter. Our data comes from a coalition of 218 farms and fields across Wisconsin and southern Minnesota. The data was collected using single variable and regression tree analysis to examine the soil characteristics: texture, drainage, and pH in relation to tillage, animal husbandry, cover cropping, manure application, and crop rotation.

There are `r nrow(data2)` rows and `r ncol(data2)`

## 2. Data



```{r Data overveiw}
Data2_clean <- janitor::clean_names(Data2)
```

```{r}
Data2 <- read_csv("../data/Data2.csv", na = ".")

```

```{r}
glimpse(Data2_clean)
```

## 3. Data analysis plan

What variables will you visualize to explore your research questions?

-   We will be looking at what type of agriculture is upon the land in which the soil was tested (e.g. turkey, beef, dairy, rye, wheat, oat, corn, soy, etc.). Additionally, we will examine what soil factors are included in the analyses like description of the soil (from sandy to “muck”, drainage of soil (“very poorly drained”, “poorly drained”, “somewhat poorly drained”, “moderately well drained”, “well drained”, “somewhat excessively well drained”, and “excessively drained”, soil type (rated on a scale), pH, regions in which the soil exists (1, 2, 3, 4, 5, 6) across Wisconsin and Minnesota, and the year in which the samples were collected (2015-2017). Secondly, we will be including the variable of manure: what species did the manure come from, what form was it (liquid, solid), how many applications was the soil exposed to. Another variable included in the dataset will be the form/type of tillage of the soil: “no tillage” (vertical tillage or strip tillage, “conventional tillage” (chisel, disk or moldboard), and the number of “tillage passes” that occurred between harvest of the previous year’s crop and the planting of the current year’s crop (0 to 4). Tillage was only considered no-tillage or minimum tillage if practiced for more than 4 years.

Will there be any other data that you need to find to help with your research question?

-   Not at the moment, but if there is, we will add it. We are also looking at narrative comments on the data in the source paper, which is still pre-print and unpublished.

The data visualization(s) that you believe will be useful in exploring your question(s). (You can update these later as you work on your project.)

-   We think that faceting might be of use to separate visualizations for soil types or crop rotation/ species grown.
-   The use of mapping or making a map colored by specific variable(s) may be helpful in visualizing soil qualities based on location/use of land (agricultural/livestock).

```{r manure pH, fig.alt= "A vertical violin plot depicting the correlation of the use of different manure types with the pH of the soil. The types of manure being none, beef cow, dairy cow, chicken, swine, and turkey. In the chart the dairy cow has the most consistent pH that falls within the ideal range for plant growth depicted with a dotted line at 6.8 and 7.5."}


Data2_clean <- Data2_clean |>
  mutate(
    mnr_source = case_when(
      mnr_source == "dairy" ~ "dairy cow",
      mnr_source == "beef" ~ "beef cow",
      TRUE ~ mnr_source
    )
  ) |>
  mutate(mnr_solid = str_to_upper(mnr_solid)) |>
  filter(mnr_source != ".") |>
  filter(mnr_solid != ".") |>
  mutate(mnr_source = fct_relevel(
    mnr_source,
    "none",
    "beef cow",
    "dairy cow",
    "chicken",
    "swine",
    "turkey"
  ))


ggplot(Data2_clean, mapping = aes(x = mnr_source, y = p_h, fill = mnr_solid)) +
  geom_violin() +
  
  scale_fill_manual(
    values = c(
      "S" = "#404688FF",
      "L" = "#21908CFF",
      "B" = "#7AD151FF",
      "NONE" = "#FDE725FF"
    ),
    breaks = c("S", "L", "B", "NONE"),
    labels = c("Solid", "Liquid", "Both", "None")
  ) +
  
  
  
  
  labs(title = "pH levels of soil with different manure sources",
       x = "Manure Type",
       y = "pH",
       fill = "State of Manure") +
  geom_hline(aes(yintercept = 6.8), linetype = "dotted", size = 0.7) +
  geom_hline(aes(yintercept = 7.5), linetype = "dotted", size = 0.7) +
  scale_color_manual(name = "pH",
                     values = c("Unhealthy" = "black", "Healthy" = "black")) +
  geom_text(aes(x = "turkey", y = 7.6), label = "Ideal pH Range")


```

```{r}
Data2_clean|> filter( springfall_till_passes != ".") |>
  
select(c(springfall_till_passes, drainage))|> 
ggplot( mapping = aes(x = drainage, y = springfall_till_passes))+
         geom_violin(fill = "darkgreen")+
  #scale_colour_viridis_d() + 
  labs(
  title = "Drainage and Tilling Correlation", subtitle = "Drainage class is rated on a scale from 1-7, ranging from 'very poorly drained' to  'excessively drained'. Tilling is the act of aerating the soil (typically with heavy machinery) to improve air circulation and water permeation. ", 
  x = "Drainage Class",
  y = "Spring- Fall Till Passes"
  
) 
```

```{r tillage drainage, fig.alt = "A stacked horizontal bar chart depicting the correlation of till passes with the drainage of the field. On the y axis being number of till passes on the x axis the number of feilds and the fill of the bars was how good the drainage was on the field."}


Data2_clean |> filter(springfall_till_passes != ".") |>  mutate(drainage = as.character(drainage)) |> group_by (springfall_till_passes, drainage) |> arrange(drainage) |>
  ggplot(aes(fill = drainage, y = springfall_till_passes)) +
  labs(title = "Tillage impact on drainage",
       x = "Number of fields",
       y = "Number of till passes",
       fill = "Drainage") +
  
  scale_fill_manual(
    values = c(
      "1" = "#440154FF",
      "2" = "#443A83FF",
      "3" = "#3B528BFF",
      "4" = "#2C728EFF",
      "5" = "#24868EFF",
      "6" = "#1F9A8AFF",
      "7" = "#47C16EFF"
    ),
    breaks = c("1", "2", "3", "4", "5", "6", "7"),
    labels = c(
      "Very poorly drained",
      "Poorly drained",
      "Somewhat poorly drained",
      "Moderately well drained",
      "Well drained",
      "Somewhat excessively well drained",
      "Excessively drained"
    )
  ) +
  
  geom_bar(position = "stack")
```

```{r}
Data2_clean|> group_by (springfall_till_passes, drainage) |> arrange(drainage)|>
ggplot(aes(fill = drainage, y = springfall_till_passes, x = drainage)) + 
  
    geom_bar(position = "stack", stat = "identity")
```
```{r}
Data2_clean|>
  ggplot(aes(x = sand, y = drainage))+
  geom_smooth()
```
```{r}
Data2_clean|>
  ggplot(aes(x = clay, y = drainage))+
  geom_smooth()
```


## 4. Data Ethics Review

The data ethics review section will be introduced in a separate class and is not part of the original proposal deadline.
